\chapter{KASUMI}
\label{ch:kas}
The KASUMI block cipher is used in the GSM A5/3 streamcipher. As GSM
is the global standard for mobile communication KASUMI replaced the
more insecure A5/1 and A5/2 as the standard form of encryption in the
2G and 3G networks. 
\section{Key schedule}
The keyschedule of the KASUMI cipher calculates all of the round keys,
from the given input key. The 128-bit key is split into eight 16-bit
subkeys, where $K_1,..K_8$ is a concatenation of subsequent 16-bit of
the original 128-bit key $K$.
\[K = K_1 || K_2 || K_3 || K_4 || K_5 || K_6 || K_7 || K_8\]
A modified key $K'$ is also generated by XOR'ing the original key with
the number \code{0x123456789ABCDEFFEDCBA9876543210}. This key $K'$ is split
into eight 16-bit subkeys as well, following the same rules of the
original key.
\[K' = K'_1 || K'_2 || K'_3 || K'_4 || K'_5 || K'_6 || K'_7 || K'_8\]
Thereafter eight round keys are generated as follows
\begin{align*}
  KLi1 &= ROL16(K_i,1)\\
  KLi2 &= K'_{i+2}\\
  KOi1 &= ROL16(K_{i + 1},5)\\
  KOi2 &= ROL16(K_{i + 5},8)\\
  KOi3 &= ROL16(K_{i + 6},13)\\
  KIi1 &= K'_{i+4}\\
  KIi2 &= K'_{i+3}\\
  KIi3 &= K'_{i+7}\\
\end{align*}
\section{Algorithm}
The KASUMI algorithm takes an 64-bit word as an input. This word is
split into two halves.
\[ inputword = L_o || R_o\]
In each round of the algorithm the right half of the input is XOR'ed
with the output of the round functions. Thereafter the right and left
values are swapped. 
\begin{align*}
  L_i &= F_i(KL_i,KO_i,KI_i,L_{i - 1}) \oplus R_{i - 1} \\
  R_i &= L_{i - 1}
\end{align*}
Where $i$ determines which round function is used. A different round
function is used for odd and even rounds of the algorithm.

The operations of the algorithm will be described as follows
\begin{lstlisting}[frame=single, language=Pascal, mathescape,
captionpos=b, caption={Pseudo code for the algorithm KASUMI}] 
for i:=1 to 8
do
     $F_{i = odd} = FO(KO_i, KI_i, FL(KL_i, L_{i - 1}))$
     $F_{i = even} = FL(KL_i, FO(KO_i,KI_i, L_{i - 1})) $
end
\end{lstlisting}
After the last round the output ciphertext is the concatenation of the
outputs.
\[cipher = L_8 || R_8\]

\subsection{FO Function}
The FO function takes an 32-bit $i$. This input is split into two
16-bit halves, consisting of the 16 leftmost bits and rightmost bits.
\[i = left_0 || right_o\]
The roundkeys $KO_{i,j}$ and $KI_{i,j}$ generated in the keyschedule
are used in each round of the the function $FO$.
The rounds of $FO$ is as follows
\begin{lstlisting}[frame=single, language=Pascal, mathescape,
captionpos=b, caption={Pseudo code for $FO$ function}] 
for j:=1 to 3
do
     $right_i = FI(L_{i-1} \oplus KO_{i,j}, KI_{i,j}) \oplus R_{i - 1}$
     $left_i = right_{i - 1}$
end
\end{lstlisting}
The output $left_3$ and $right_3$ after the $3$rd iteration will be
the output of the function $FO$.
\[o = left_3' || right_3'\]
\subsection{FL Function}
As in FO, the FL function takes an input of 32-bit $i$ and split it into
halves of 16-bit.
\[i = left || right\]
The roundkey $KL_{i,j}$ from the keyschedule is used by $FL$.

The operations performed on the input data are defined as
\begin{lstlisting}[frame=single, language=Pascal, mathescape,
captionpos=b, caption={Pseudo code for $FL$ function}] 
for j:=1 to 3
do
     $right' = right \oplus ROL16(L \lor KLi1)$
     $left' = left \oplus ROL16(right \land KLi2)$
end
\end{lstlisting}
The output of the function $FL$ is as follows
\[o = left' || right'\]
\subsection{FI Function}
The FI function takes a 16-bit input $i$ and a 16-bit input $KI_{i,j}$,
where $KI_{i,j}$ corresponds to a given roundkey from the keyschedule. The
roundkeys alternate for each round and is a key from either $KI_{i,1}$, $KI_{i,j}$
or $KI_{i,j}$.

Two substitution boxes are introduces S7 and S9. The substitution
boxes are declared as two lookup tables\footnote{see Appendix
  \ref{sec:subbox}}, used in $FI$.

As in the previous functions $i$ is split into two, but in FI it
consist of the leftmost 9 bits and rightmost 7 bits.
\[ i = left_o || right_o \]
The operations is defines as
\begin{lstlisting}[frame=single, language=Pascal, mathescape,
captionpos=b, caption={Pseudo code for $FI$ function}] 
do
     $left_1  = right_0$
     $right_1 = S9(left_o) \oplus right_0$
     $left_2  = right_1 \oplus KI_{i,1}$
     $right_2 = S7(left_1) \oplus right_1 \oplus KI_{i,1}$
     $left_3  = right_2$
     $right_3 = S9(left_2) \oplus right_2$
     $left_4  = S7(left_3) \oplus right_3$
     $right_4 = right_3$
end
\end{lstlisting}
The function will return the following 16-bit value as output
\[o = left_4 || right_4\]
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "Thesis"
%%% End:
